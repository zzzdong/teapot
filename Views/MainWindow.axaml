<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewmodels="using:Teapot.ViewModels"
        xmlns:models="using:Teapot.Models"
        xmlns:i="https://github.com/projektanker/icons.avalonia"
        x:DataType="viewmodels:MainWindowViewModel"
        mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="800"
        x:Class="Teapot.Views.MainWindow"
        Title="Teapot - API Debugger">

  <DockPanel>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <Border DockPanel.Dock="Top" 
            Height="50">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="15,0,0,0" VerticalAlignment="Center">
          <i:Icon Value="fa-solid fa-mug-hot" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
          <TextBlock Text="Teapot" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
        </StackPanel>
        
        <ComboBox Grid.Column="1" 
                  Name="EnvironmentComboBox" 
                  ItemsSource="{Binding Environments}"
                  DisplayMemberBinding="{Binding Name}"
                  SelectedItem="{Binding SelectedEnvironment, Mode=TwoWay}"
                  Width="200"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Center"/>
                  
        <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,15,0" VerticalAlignment="Center">
          <Button Content="Import" Margin="0,0,10,0"/>
          <Button Content="Export" Margin="0,0,10,0"/>
          <Button Content="Settings"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- åº•éƒ¨çŠ¶æ€æ  -->
    <Border DockPanel.Dock="Bottom" 
            Height="30">
      <Grid ColumnDefinitions="Auto,*">
        <TextBlock Grid.Column="0" Text="Ready" VerticalAlignment="Center" Margin="10,0,0,0"/>
        
        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,15,0" VerticalAlignment="Center">
          <TextBlock Text="{Binding SelectedRequest.Method}" Margin="0,0,10,0" VerticalAlignment="Center"/>
          <TextBlock Text="|" Margin="0,0,10,0" VerticalAlignment="Center"/>
          <TextBlock Text="{Binding SelectedEnvironment.Name}" Margin="0,0,10,0" VerticalAlignment="Center"/>
          <TextBlock Text="|" Margin="0,0,10,0" VerticalAlignment="Center"/>
          <TextBlock Name="CurrentTimeTextBlock" Text="00:00:00" VerticalAlignment="Center"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <Grid>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="280" />
        <ColumnDefinition Width="5" />
        <ColumnDefinition Width="*" MinWidth="300" />
        <ColumnDefinition Width="5" />
        <ColumnDefinition Width="300" />
      </Grid.ColumnDefinitions>

      <!-- å·¦ä¾§è¾¹æ  -->
      <Border Grid.Column="0">
        <TabControl Margin="5">
          <TabItem Header="History">
            <DockPanel Margin="5">
              <Grid DockPanel.Dock="Top" Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox Grid.Column="0" Name="SearchBox" Watermark="Search history..." Margin="0,0,5,0"/>
                <Button Grid.Column="1" Content="Clear" Width="60" Height="30"/>
              </Grid>
              <ListBox Name="HistoryListBox" 
                       ItemsSource="{Binding History}" 
                       SelectedItem="{Binding SelectedRequest, Mode=TwoWay}"
                       Margin="0,5,0,0">
                <ListBox.ItemTemplate>
                  <DataTemplate>
                    <Grid Margin="5" ColumnDefinitions="Auto,*,Auto,Auto">
                      <TextBlock Grid.Column="0" Text="{Binding Method}" Padding="5,2" Background="#E0E0E0" Margin="0,0,5,0"/>
                      <TextBlock Grid.Column="1" Text="{Binding Name}" TextTrimming="CharacterEllipsis" MaxWidth="150" VerticalAlignment="Center"/>
                      <TextBlock Grid.Column="2" Text="{Binding Url}" TextTrimming="CharacterEllipsis" MaxWidth="150" VerticalAlignment="Center" Margin="5,0"/>
                      <TextBlock Grid.Column="3" Text="Recent" VerticalAlignment="Center" Margin="5,0"/>
                    </Grid>
                  </DataTemplate>
                </ListBox.ItemTemplate>
              </ListBox>
            </DockPanel>
          </TabItem>
          
          <TabItem Header="Collections">
            <DockPanel Margin="5">
              <Grid DockPanel.Dock="Top" Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox Grid.Column="0" Name="CollectionSearchBox" Watermark="Search collections..." Margin="0,0,5,0"/>
                <Button Grid.Column="1" Content="+" Width="30" Height="30"/>
              </Grid>
              <TreeView Name="CollectionsTreeView" 
                        ItemsSource="{Binding Collections}"
                        SelectedItem="{Binding SelectedCollection, Mode=TwoWay}"
                        Margin="0,5,0,0">
                <TreeView.ItemTemplate>
                  <TreeDataTemplate DataType="viewmodels:CollectionItemViewModel">
                    <StackPanel Orientation="Horizontal">
                      <Image Source="{Binding Icon}" Width="16" Height="16" Margin="0,0,5,0"/>
                      <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                    </StackPanel>
                  </TreeDataTemplate>
                </TreeView.ItemTemplate>
              </TreeView>
            </DockPanel>
          </TabItem>
        </TabControl>
      </Border>

      <!-- å·¦å³åˆ†éš”çº¿ -->
      <GridSplitter Grid.Column="1" 
                    Width="5" 
                    ResizeDirection="Columns"
                    HorizontalAlignment="Stretch" />

      <!-- ä¸»å·¥ä½œåŒº -->
      <Grid Grid.Column="2" Margin="10,10,10,10">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- è¯·æ±‚æ–¹æ³•å’ŒURL -->
        <Border Grid.Row="0" 
                Padding="10"
                Margin="0,0,0,10">
          <Grid ColumnDefinitions="120,*,80">
            <ComboBox Grid.Column="0" 
                      Name="MethodComboBox" 
                      ItemsSource="{Binding HttpMethodOptions}"
                      SelectedItem="{Binding SelectedRequest.Method, Mode=TwoWay}"/>
            <TextBox Grid.Column="1" 
                     Text="{Binding SelectedRequest.Url, Mode=TwoWay}" 
                     Watermark="Enter request URL"/>
            <Button Grid.Column="2" 
                    Name="SendButton" 
                    Content="Send"/>
          </Grid>
        </Border>

        <!-- ä¸»TabæŽ§ä»¶ï¼Œæ¯ä¸ªTabåŒ…å«ç‹¬ç«‹çš„è¯·æ±‚æž„å»ºå™¨å’Œå“åº”æŸ¥çœ‹å™¨ -->
        <Grid Grid.Row="1">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>
          
          <Grid Name="TabsContainer" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TabControl Grid.Column="0" Name="MainTabs" HorizontalAlignment="Stretch">
              <TabItem Header="{Binding SelectedRequest.Name}">
                <Grid>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                  </Grid.RowDefinitions>

                  <!-- è¯·æ±‚æž„å»ºå™¨å’Œå“åº”æŸ¥çœ‹å™¨ -->
                  <Grid Grid.Row="0" RowDefinitions="*,*">
                    <!-- ä¸ŠåŠéƒ¨åˆ† - è¯·æ±‚æž„å»ºå™¨ -->
                    <Border Grid.Row="0" 
                            Margin="0,0,0,10">
                      <TabControl>
                        <TabItem Header="Params">
                          <ScrollViewer>
                            <ItemsControl ItemsSource="{Binding SelectedRequest.QueryParameters}">
                              <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                  <Grid Margin="5" ColumnDefinitions="30,*,*">
                                    <CheckBox Grid.Column="0" IsChecked="{Binding IsActive, Mode=TwoWay}" VerticalAlignment="Center"/>
                                    <TextBox Grid.Column="1" Text="{Binding Key, Mode=TwoWay}" Watermark="Key" Margin="5,0"/>
                                    <TextBox Grid.Column="2" Text="{Binding Value, Mode=TwoWay}" Watermark="Value" Margin="5,0"/>
                                  </Grid>
                                </DataTemplate>
                              </ItemsControl.ItemTemplate>
                            </ItemsControl>
                          </ScrollViewer>
                        </TabItem>
                        
                        <TabItem Header="Authorization">
                          <StackPanel Margin="10">
                            <ComboBox Name="AuthTypeComboBox" 
                                      ItemsSource="{Binding AuthTypes}"
                                      SelectedItem="{Binding SelectedRequest.Authentication.Type, Mode=TwoWay}"/>
                            
                            <Grid Name="AuthFieldsGrid" IsVisible="{Binding IsAuthFieldsVisible}">
                              <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                              </Grid.RowDefinitions>
                              <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                              </Grid.ColumnDefinitions>
                              
                              <TextBlock Grid.Row="0" Grid.Column="0" Text="Username:" VerticalAlignment="Center"/>
                              <TextBox Grid.Row="0" Grid.Column="1" 
                                       Text="{Binding SelectedRequest.Authentication.Username, Mode=TwoWay}" 
                                       IsVisible="{Binding IsBasicAuth}" />
                                       
                              <TextBlock Grid.Row="1" Grid.Column="0" Text="Password:" VerticalAlignment="Center"/>
                              <TextBox Grid.Row="1" Grid.Column="1" 
                                       Text="{Binding SelectedRequest.Authentication.Password, Mode=TwoWay}" 
                                       IsVisible="{Binding IsBasicAuth}" />
                                       
                              <TextBlock Grid.Row="0" Grid.Column="0" Text="Token:" VerticalAlignment="Center" 
                                         IsVisible="{Binding IsBearerToken}"/>
                              <TextBox Grid.Row="0" Grid.Column="1" 
                                       Text="{Binding SelectedRequest.Authentication.Token, Mode=TwoWay}" 
                                       IsVisible="{Binding IsBearerToken}" />
                            </Grid>
                          </StackPanel>
                        </TabItem>
                        
                        <TabItem Header="Headers">
                          <ScrollViewer>
                            <ItemsControl ItemsSource="{Binding SelectedRequest.Headers}">
                              <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                  <Grid Margin="5" ColumnDefinitions="30,*,*">
                                    <CheckBox Grid.Column="0" IsChecked="{Binding IsActive, Mode=TwoWay}" VerticalAlignment="Center"/>
                                    <TextBox Grid.Column="1" Text="{Binding Key, Mode=TwoWay}" Watermark="Key" Margin="5,0"/>
                                    <TextBox Grid.Column="2" Text="{Binding Value, Mode=TwoWay}" Watermark="Value" Margin="5,0"/>
                                  </Grid>
                                </DataTemplate>
                              </ItemsControl.ItemTemplate>
                            </ItemsControl>
                          </ScrollViewer>
                        </TabItem>
                        
                        <TabItem Header="Body">
                          <StackPanel>
                            <ComboBox Name="BodyTypeComboBox" 
                                      ItemsSource="{Binding BodyTypes}"
                                      SelectedItem="{Binding SelectedRequest.BodyType, Mode=TwoWay}"/>
                            
                            <TextBox Name="BodyTextBox" 
                                     Text="{Binding SelectedRequest.Body, Mode=TwoWay}"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     FontFamily="Consolas"
                                     IsVisible="{Binding IsBodyVisible}"
                                     Height="200"/>
                          </StackPanel>
                        </TabItem>
                        
                        <TabItem Header="Pre-request Script">
                          <TextBox Name="PreRequestScriptTextBox" 
                                   Text="{Binding SelectedPreRequestScriptCode, Mode=TwoWay}"
                                   AcceptsReturn="True"
                                   TextWrapping="Wrap"
                                   FontFamily="Consolas"/>
                        </TabItem>
                        
                        <TabItem Header="Tests">
                          <TextBox Name="TestScriptTextBox" 
                                   Text="{Binding SelectedTestScriptCode, Mode=TwoWay}"
                                   AcceptsReturn="True"
                                   TextWrapping="Wrap"
                                   FontFamily="Consolas"/>
                        </TabItem>
                      </TabControl>
                    </Border>

                    <!-- ä¸‹åŠéƒ¨åˆ† - å“åº”æŸ¥çœ‹å™¨ -->
                    <Grid Grid.Row="1">
                      <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                      </Grid.RowDefinitions>
                      
                      <!-- å“åº”ä¿¡æ¯æ  -->
                      <Border Grid.Row="0" 
                              Padding="10">
                        <StackPanel Orientation="Horizontal">
                          <TextBlock Text="{Binding CurrentResponse.StatusCode, StringFormat='{}Status: {0}'}" FontWeight="Bold" Margin="0,0,15,0"/>
                          <TextBlock Text="{Binding CurrentResponse.StatusDescription}" Margin="0,0,15,0"/>
                          <TextBlock Text="{Binding CurrentResponse.ResponseTime, StringFormat='â±ï¸ {0}'}" Margin="0,0,15,0"/>
                          <TextBlock Text="{Binding CurrentResponse.ContentLength, StringFormat='ðŸ“¥ {0} bytes'}"/>
                        </StackPanel>
                      </Border>
                      
                      <!-- å“åº”å†…å®¹ -->
                      <TabControl Grid.Row="1" Margin="0,10,0,0">
                        <TabItem Header="Body">
                          <ScrollViewer>
                            <TextBox Name="ResponseBodyTextBox" 
                                     Text="{Binding CurrentResponse.Body}"
                                     IsReadOnly="True"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     FontFamily="Consolas"/>
                          </ScrollViewer>
                        </TabItem>
                        
                        <TabItem Header="Headers">
                          <ScrollViewer>
                            <ItemsControl ItemsSource="{Binding CurrentResponse.Headers}">
                              <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                  <Grid Margin="5" ColumnDefinitions="*,*">
                                    <TextBlock Grid.Column="0" Text="{Binding Key}" FontWeight="Bold" Margin="0,0,5,0"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Value}" TextWrapping="Wrap"/>
                                  </Grid>
                                </DataTemplate>
                              </ItemsControl.ItemTemplate>
                            </ItemsControl>
                          </ScrollViewer>
                        </TabItem>
                        
                        <TabItem Header="Cookies">
                          <ScrollViewer>
                            <ItemsControl ItemsSource="{Binding CurrentResponse.Cookies}">
                              <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                  <Grid Margin="5" ColumnDefinitions="*,*,*">
                                    <TextBlock Grid.Column="0" Text="{Binding Name}" FontWeight="Bold" Margin="0,0,5,0"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Value}" TextWrapping="Wrap" Margin="0,0,5,0"/>
                                    <TextBlock Grid.Column="2" Text="{Binding Domain}" TextWrapping="Wrap"/>
                                  </Grid>
                                </DataTemplate>
                              </ItemsControl.ItemTemplate>
                            </ItemsControl>
                          </ScrollViewer>
                        </TabItem>
                        
                        <TabItem Header="Test Results">
                          <ScrollViewer>
                            <ItemsControl ItemsSource="{Binding CurrentResponse.TestResults}">
                              <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                  <Grid Margin="5" ColumnDefinitions="30,*,*">
                                    <CheckBox Grid.Column="0" IsChecked="{Binding Passed}" IsEnabled="False" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="{Binding TestName}" FontWeight="Bold" Margin="5,0"/>
                                    <TextBlock Grid.Column="2" Text="{Binding Message}" TextWrapping="Wrap"/>
                                  </Grid>
                                </DataTemplate>
                              </ItemsControl.ItemTemplate>
                            </ItemsControl>
                          </ScrollViewer>
                        </TabItem>
                      </TabControl>
                    </Grid>
                  </Grid>
                </Grid>
              </TabItem>
            </TabControl>
            
            <Button Grid.Column="1"
                    Name="AddTabButton"
                    Content="âž•" 
                    Width="30" 
                    Height="30" 
                    Margin="5,0,0,0"
                    VerticalAlignment="Top"
                    HorizontalAlignment="Right"
                    Command="{Binding AddNewTabCommand}"/>
          </Grid>
        </Grid>
      </Grid>

      <!-- ä¸­å³åˆ†éš”çº¿ -->
      <GridSplitter Grid.Column="3" 
                    Width="5" 
                    ResizeDirection="Columns"
                    HorizontalAlignment="Stretch" />

      <!-- å³ä¾§è¾¹æ  -->
      <Border Grid.Column="4">
        <TabControl Margin="5">
          <TabItem Header="Environment">
            <DockPanel Margin="5">
              <ComboBox DockPanel.Dock="Top" 
                        ItemsSource="{Binding Environments}"
                        DisplayMemberBinding="{Binding Name}"
                        SelectedItem="{Binding SelectedEnvironment, Mode=TwoWay}"
                        Margin="0,0,0,10"/>

              <Grid DockPanel.Dock="Top" Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Button Grid.Column="0" Content="Add Variable" Margin="0,0,5,0"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                  <Button Content="Export" Margin="0,0,5,0"/>
                  <Button Content="Import"/>
                </StackPanel>
              </Grid>
              
              <ScrollViewer>
                <ItemsControl ItemsSource="{Binding SelectedEnvironment.Variables}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Grid Margin="5" ColumnDefinitions="30,*,*,Auto">
                        <CheckBox Grid.Column="0" IsChecked="True" VerticalAlignment="Center"/>
                        <TextBox Grid.Column="1" Text="{Binding Key, Mode=TwoWay}" Watermark="Key" Margin="5,0"/>
                        <TextBox Grid.Column="2" Text="{Binding Value, Mode=TwoWay}" Watermark="Value" Margin="5,0"/>
                        <StackPanel Grid.Column="3" Orientation="Horizontal">
                          <Button Content="ðŸ‘" Margin="2,0" Width="25"/>
                          <Button Content="ðŸ—‘" Width="25"/>
                        </StackPanel>
                      </Grid>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </ScrollViewer>
            </DockPanel>
          </TabItem>
          
          <TabItem Header="Tests">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
              <TextBlock Text="âœ…" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,10"/>
              <TextBlock Text="Tests panel placeholder" HorizontalAlignment="Center" Foreground="#888"/>
            </StackPanel>
          </TabItem>
          
          <TabItem Header="Console">
            <DockPanel>
              <Button DockPanel.Dock="Top" Content="Clear" HorizontalAlignment="Right" Margin="0,5,0,10"/>
              
              <ScrollViewer>
                <ItemsControl>
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="80"/>
                          <ColumnDefinition Width="60"/>
                          <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="12:00:00" FontSize="10" Foreground="#888"/>
                        <TextBlock Grid.Column="1" Text="LOG" FontSize="10" Foreground="Blue"/>
                        <TextBlock Grid.Column="2" Text="Log message here" FontSize="10"/>
                      </Grid>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </ScrollViewer>
            </DockPanel>
          </TabItem>
        </TabControl>
      </Border>
    </Grid>
  </DockPanel>
</Window>