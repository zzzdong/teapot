<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2006"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewmodels="using:Teapot.ViewModels"
        xmlns:views="using:Teapot.Views"
        xmlns:i="https://github.com/projektanker/icons.avalonia"
        xmlns:ui="using:FluentAvalonia.UI.Controls"
        xmlns:models="using:Teapot.Models"
        xmlns:ia="using:Avalonia.Xaml.Interactions.Core"
        xmlns:interactions="using:Avalonia.Xaml.Interactions"
        xmlns:services="using:Teapot.Services"
        x:DataType="viewmodels:MainWindowViewModel"
        mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="800"
        x:Class="Teapot.Views.MainWindow"
        Title="Teapot - API Debugger">

  <DockPanel>
    <!-- 顶部导航栏 -->
    <Border DockPanel.Dock="Top" 
            Height="50">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="15,0,0,0" VerticalAlignment="Center">
          <i:Icon Value="fa-solid fa-mug-hot" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
          <TextBlock Text="Teapot" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
        </StackPanel>
        
        <ComboBox Grid.Column="1" 
                  Name="EnvironmentComboBox" 
                  ItemsSource="{Binding Environments}"
                  DisplayMemberBinding="{Binding Name}"
                  SelectedItem="{Binding SelectedEnvironment, Mode=TwoWay}"
                  Width="200"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Center"/>
                  
        <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,15,0" VerticalAlignment="Center">
          <Button Content="Import" Margin="0,0,10,0"/>
          <Button Content="Export" Margin="0,0,10,0"/>
          <Button Content="Settings"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- 底部状态栏 -->
    <Border DockPanel.Dock="Bottom" 
            Height="30">
      <Grid ColumnDefinitions="Auto,*">
        <TextBlock Grid.Column="0" Text="Ready" VerticalAlignment="Center" Margin="10,0,0,0"/>
        
        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,15,0" VerticalAlignment="Center">
          <TextBlock Text="{Binding SelectedEnvironment.Name}" Margin="0,0,10,0" VerticalAlignment="Center"/>
          <TextBlock Text="|" Margin="0,0,10,0" VerticalAlignment="Center"/>
          <TextBlock Name="CurrentTimeTextBlock" Text="00:00:00" VerticalAlignment="Center"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- 主内容区域 -->
    <Grid>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="280" />
        <ColumnDefinition Width="5" />
        <ColumnDefinition Width="*" MinWidth="300" />
        <ColumnDefinition Width="5" />
        <ColumnDefinition Width="300" />
      </Grid.ColumnDefinitions>

      <!-- 左侧边栏 -->
      <Border Grid.Column="0">
        <views:SidebarControl DataContext="{Binding}" />
      </Border>

      <!-- 左右分隔线 -->
      <GridSplitter Grid.Column="1" 
                    Width="5" 
                    ResizeDirection="Columns"
                    HorizontalAlignment="Stretch" />

      <!-- 主工作区 - 使用FluentAvalonia的TabView -->
      <Border Grid.Column="2" Margin="10,10,10,10">
        <ui:TabView Name="MainTabs"
                    TabWidthMode="SizeToContent"
                    CanReorderTabs="True"
                    TabItems="{Binding WorkingRequests}"
                    SelectedIndex="{Binding SelectedTabIndex}"
                    IsAddTabButtonVisible="True"
                    AddTabButtonCommand="{Binding AddNewTabCommand}">
          <Interaction.Behaviors>
              <EventTriggerBehavior EventName="TabCloseRequested">
                  <ia:InvokeCommandAction Command="{Binding CloseTabCommand}" PassEventArgsToCommand="True" />
              </EventTriggerBehavior>
          </Interaction.Behaviors>
          <ui:TabView.TabItemTemplate>
            <DataTemplate DataType="models:HttpRequestModel">
              <ui:TabViewItem Header="{Binding Name}">
                <views:RequestPanel Tag="{Binding .}" />
              </ui:TabViewItem>
            </DataTemplate>
          </ui:TabView.TabItemTemplate>
        </ui:TabView>
      </Border>

      <!-- 中右分隔线 -->
      <GridSplitter Grid.Column="3" 
                    Width="5" 
                    ResizeDirection="Columns"
                    HorizontalAlignment="Stretch" />

      <!-- 右侧边栏 -->
      <Border Grid.Column="4">
        <views:AuxiliaryPanelControl DataContext="{Binding}" />
      </Border>
    </Grid>
  </DockPanel>
</Window>